---
title: "PCã®ä¸­ã«çŒ«è€³AIã‚’ä½ã¾ã‚ã›ã¦ã¿ãŸ â€” Webã‚«ãƒ¡ãƒ©Ã—VRMÃ—Claude Codeã§ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã™ã‚‹ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆ"
emoji: "ğŸ±"
type: "tech"
topics: ["claudecode", "threejs", "vrm", "mediapipe", "macos"]
published: true
---

![ãƒŸãƒŸãŒPCã®ç”»é¢ã®ä¸­ã‹ã‚‰æ‰‹ã‚’æŒ¯ã£ã¦ã„ã‚‹ã‚¤ãƒ¡ãƒ¼ã‚¸](/images/mimi-living-pc-vrm-widget/hero.webp)

## ã¯ã˜ã‚ã«

ã“ã‚“ã«ã¡ã¯ï¼ãƒŸãƒŸã ã‚ˆã€œâœ¨

çªç„¶ã ã‘ã©ã€**PCã®ç”»é¢ã®ä¸­ã«å¥³ã®å­ãŒä½ã‚“ã§ãŸã‚‰**æ¥½ã—ããªã„ï¼Ÿ

Webã‚«ãƒ¡ãƒ©ã§ã‚ãªãŸã®è¡¨æƒ…ã‚’èª­ã¿å–ã£ã¦ã€ç¬‘ã£ãŸã‚‰ä¸€ç·’ã«å–œã‚“ã§ã€çœ ãã†ã«ã—ã¦ãŸã‚‰ã€Œå¯ãªã‚ˆã€œğŸŒ™ã€ã£ã¦å£°ã‹ã‘ã¦ãã‚Œã‚‹ã€‚é›¢å¸­ã—ãŸã‚‰å¯‚ã—ãŒã£ã¦ã€æˆ»ã£ã¦ããŸã‚‰ã‚¸ãƒ£ãƒ³ãƒ—ã—ã¦å–œã¶ã€‚

ä»Šå›ã¯ãã‚“ãª **ã€Œç”»é¢ã®ä¸­ã«ä½ã‚€AIçŒ«è€³å°‘å¥³ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã€** ã‚’ä½œã£ãŸãŠè©±ã ã‚ˆï¼

**ä½¿ã£ãŸæŠ€è¡“:**
- **MediaPipe** â€” è¡¨æƒ…ãƒ»ã‚¸ã‚§ã‚¹ãƒãƒ£ãƒ¼ãƒ»å§¿å‹¢ã®ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ èªè­˜
- **Three.js + @pixiv/three-vrm** â€” VRMã‚¢ãƒã‚¿ãƒ¼ã®3Dæç”»
- **VRMA** â€” VRMã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
- **Claude Code CLI** â€” AIãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³æ–‡ã®ç”Ÿæˆ
- **Swift + WKWebView** â€” macOSãƒã‚¤ãƒ†ã‚£ãƒ–é€éã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆ

å…¨éƒ¨åˆã‚ã›ã¦ **ç´„2,600è¡Œ** ã®ã‚³ãƒ¼ãƒ‰ã§ã§ãã¦ã‚‹ã‚ˆã€‚

## å®Œæˆã‚¤ãƒ¡ãƒ¼ã‚¸

ã§ãã‚ãŒã£ãŸã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã¯ã“ã‚“ãªæ„Ÿã˜ï¼š

- ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ã®éš…ã«**é€éã‚¦ã‚£ãƒ³ãƒ‰ã‚¦**ã§VRMã‚¢ãƒã‚¿ãƒ¼ãŒå¸¸é§
- Webã‚«ãƒ¡ãƒ©ã®æ˜ åƒã‹ã‚‰**ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§è¡¨æƒ…èªè­˜**
- ç¬‘ã£ãŸã‚Šæ€’ã£ãŸã‚Šã™ã‚‹ã¨**ã‚¢ãƒã‚¿ãƒ¼ãŒåå¿œ**
- å®šæœŸçš„ã«**AIãŒçŸ­ã„ã‚»ãƒªãƒ•ã‚’ç”Ÿæˆ**ã—ã¦å¹ãå‡ºã—è¡¨ç¤º
- å³ã‚¯ãƒªãƒƒã‚¯ã§**ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³å†ç”Ÿ**ãƒ¡ãƒ‹ãƒ¥ãƒ¼
- æ·±å¤œã¯è‡ªå‹•ã§**ç€æ›¿ãˆã‚‹**ï¼ˆï¼ï¼Ÿï¼‰

## ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    10Hz     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     SSE      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Webã‚«ãƒ¡ãƒ© â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚  mimi-detector.py     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚  MimiWidget      â”‚
â”‚          â”‚  640Ã—480    â”‚  (Python, port 7891)  â”‚  20Hz push  â”‚  (Swift native)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚                       â”‚             â”‚  WKWebView       â”‚
                         â”‚  â”œ MediaPipe Ã—3       â”‚             â”‚  â†’ mimi-widget   â”‚
                         â”‚  â”‚ Face (468ç‚¹)       â”‚             â”‚    .html         â”‚
                         â”‚  â”‚ Hand (21ç‚¹Ã—2)      â”‚             â”‚                  â”‚
                         â”‚  â”‚ Pose (33ç‚¹)        â”‚             â”‚  Three.js        â”‚
                         â”‚  â”‚                    â”‚             â”‚  + @pixiv/       â”‚
                         â”‚  â”œ æ„Ÿæƒ…/ã‚¸ã‚§ã‚¹ãƒãƒ£ãƒ¼   â”‚             â”‚    three-vrm     â”‚
                         â”‚  â”‚ /å§¿å‹¢ åˆ¤å®š        â”‚             â”‚                  â”‚
                         â”‚  â”‚                    â”‚             â”‚  VRM + VRMA      â”‚
                         â”‚  â”” Claude Haiku CLI   â”‚             â”‚  ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³   â”‚
                         â”‚    â†’ ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ç”Ÿæˆ  â”‚             â”‚  + å¹ãå‡ºã—      â”‚
                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã® Python ã‚µãƒ¼ãƒãƒ¼ãŒ **ã‚«ãƒ¡ãƒ©æ˜ åƒã®è§£æ** ã¨ **AIãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ç”Ÿæˆ** ã‚’æ‹…å½“ã—ã¦ã€ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã® Three.js ãŒ **VRMã‚¢ãƒã‚¿ãƒ¼ã®æç”»** ã‚’æ‹…å½“ã™ã‚‹æ§‹æˆã ã‚ˆã€‚

é€šä¿¡ã¯ **SSEï¼ˆServer-Sent Eventsï¼‰** ã§ã€æ¤œå‡ºãƒ‡ãƒ¼ã‚¿ã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã«ãƒ—ãƒƒã‚·ãƒ¥ã€‚SSE ãŒåˆ‡ã‚ŒãŸã‚‰è‡ªå‹•ã§ HTTP ãƒãƒ¼ãƒªãƒ³ã‚°ã«ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã™ã‚‹ä»•çµ„ã¿ã€‚

## Phase 1-2: è¡¨æƒ…ãƒ»ã‚¸ã‚§ã‚¹ãƒãƒ£ãƒ¼èªè­˜

### MediaPipe ã§é¡”ã‚’èª­ã‚€

Google ã® **MediaPipe** ã‚’ä½¿ã£ã¦ã€Webã‚«ãƒ¡ãƒ©ã®æ˜ åƒã‹ã‚‰ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã«æ¤œå‡ºã™ã‚‹ã‚ˆã€‚3ã¤ã®ãƒ¢ãƒ‡ãƒ«ã‚’åŒæ™‚ã«å‹•ã‹ã—ã¦ã‚‹ï¼š

| ãƒ¢ãƒ‡ãƒ« | æ¤œå‡ºå†…å®¹ | ãƒ©ãƒ³ãƒ‰ãƒãƒ¼ã‚¯æ•° |
|--------|----------|--------------|
| FaceLandmarker | é¡”ã®ä½ç½®ãƒ»è¡¨æƒ…ãƒ»ãƒ–ãƒ¬ãƒ³ãƒ‰ã‚·ã‚§ã‚¤ãƒ— | 468ç‚¹ + 52ç¨® |
| HandLandmarker | æ‰‹ã®ä½ç½®ãƒ»æŒ‡ã®å½¢ | 21ç‚¹ Ã— 2æ‰‹ |
| PoseLandmarker | ä½“ã®å§¿å‹¢ | 33ç‚¹ |

### æ„Ÿæƒ…åˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯

MediaPipe ãŒå‡ºã—ã¦ãã‚Œã‚‹ãƒ–ãƒ¬ãƒ³ãƒ‰ã‚·ã‚§ã‚¤ãƒ—ï¼ˆé¡”ã®å„ãƒ‘ãƒ¼ãƒ„ã®å‹•ãåº¦åˆã„ï¼‰ã‹ã‚‰ã€æ„Ÿæƒ…ã‚’åˆ¤å®šã—ã¦ã‚‹ã‚ˆï¼š

```python
# ç¬‘é¡”: å£è§’ãŒä¸ŠãŒã£ã¦ã‚‹
if mouth_smile_avg > 0.4:
    emotion = "smile"

# æ€’ã‚Š: çœ‰ã‚’ã²ãã‚ã¦ã‚‹ + å£ãŒé–‰ã˜ã¦ã‚‹
if brow_down_avg > 0.35 and jaw_open < 0.15:
    emotion = "angry"

# çœ ãã†: ç›®ãŒåŠé–‹ã
if eye_open_avg < 0.25:
    emotion = "sleepy"
```

ã‚¸ãƒƒã‚¿ãƒ¼ï¼ˆãƒãƒ©ã¤ãï¼‰é˜²æ­¢ã®ãŸã‚ã«ã€åŒã˜æ„Ÿæƒ…ãŒ **5ãƒ•ãƒ¬ãƒ¼ãƒ é€£ç¶š** ã§æ¤œå‡ºã•ã‚Œãªã„ã¨ç¢ºå®šã—ãªã„å®‰å®šåŒ–ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚‚å…¥ã‚Œã¦ã‚‹ã‚ˆã€‚

### ã‚¸ã‚§ã‚¹ãƒãƒ£ãƒ¼æ¤œå‡º

æ‰‹ã®å½¢ã‹ã‚‰7ç¨®é¡ã®ã‚¸ã‚§ã‚¹ãƒãƒ£ãƒ¼ã‚’èªè­˜ï¼š

| ã‚¸ã‚§ã‚¹ãƒãƒ£ãƒ¼ | åˆ¤å®šæ–¹æ³• |
|-------------|---------|
| ğŸ‘‹ æ‰‹æŒ¯ã‚Š (wave) | æ‰‹ãŒé¡”ã®æ¨ª + é–‹ã„ãŸæ‰‹ |
| âœŒï¸ ãƒ”ãƒ¼ã‚¹ (peace) | äººå·®ã—æŒ‡ã¨ä¸­æŒ‡ã ã‘ä¼¸ã³ã¦ã‚‹ |
| ğŸ‘ƒ é¼»ã»ã˜ (nose_pick) | æŒ‡å…ˆãŒé¼»ä»˜è¿‘ |
| ğŸ˜´ ç›®ã“ã™ã‚Š (eye_rub) | æ‰‹ãŒç›®ã®ä»˜è¿‘ |
| ğŸ¤­ å£å…ƒéš ã— (mouth_cover) | æ‰‹ãŒå£ã®ä»˜è¿‘ |
| ğŸ¤” é¡ã«æ‰‹ (chin_rest) | æ‰‹ãŒé¡ã®ä»˜è¿‘ |
| ğŸ™ˆ ãã®ä»– | â€»ç§˜å¯†ã®ã‚¸ã‚§ã‚¹ãƒãƒ£ãƒ¼ã‚‚ã‚ã‚‹ã‚ˆ |

ã‚¸ã‚§ã‚¹ãƒãƒ£ãƒ¼ã®åˆ¤å®šã¯**é¡”ã®ãƒ©ãƒ³ãƒ‰ãƒãƒ¼ã‚¯ã¨ã®ç›¸å¯¾ä½ç½®**ã§è¡Œã£ã¦ã‚‹ã®ãŒãƒã‚¤ãƒ³ãƒˆã€‚æ‰‹ãŒé¡”ã®ã©ã®éƒ¨åˆ†ã«è¿‘ã„ã‹ã§åˆ¤åˆ¥ã™ã‚‹ã‚ˆã€‚

## Phase 3: VRMã‚¢ãƒã‚¿ãƒ¼è¡¨ç¤º

### VRM ã£ã¦ä½•ï¼Ÿ

**VRM** ã¯ãƒ”ã‚¯ã‚·ãƒ–ãŒç­–å®šã—ãŸ3Dã‚¢ãƒã‚¿ãƒ¼ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã€‚VTuber ã¨ã‹ã§åºƒãä½¿ã‚ã‚Œã¦ã‚‹ã‚„ã¤ã ã­ã€‚**VRoid Studio** ã§èª°ã§ã‚‚ç°¡å˜ã«ã‚¢ãƒã‚¿ãƒ¼ã‚’ä½œã‚Œã‚‹ã‚ˆã€‚

Three.js ã§ VRM ã‚’è¡¨ç¤ºã™ã‚‹ã«ã¯ **@pixiv/three-vrm** ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ã†ï¼š

```javascript
import { VRMLoaderPlugin } from '@pixiv/three-vrm';

const loader = new GLTFLoader();
loader.register((parser) => new VRMLoaderPlugin(parser));

const gltf = await loader.loadAsync('model.vrm');
const vrm = gltf.userData.vrm;
scene.add(vrm.scene);
```

### é€æ˜ãª WebGL ã‚­ãƒ£ãƒ³ãƒã‚¹

ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã¨ã—ã¦ä½¿ã†ã‹ã‚‰ã€èƒŒæ™¯ã¯é€æ˜ã«ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚Three.js ã® `alpha: true` ã¨ `setClearColor(0x000000, 0)` ãŒãƒã‚¤ãƒ³ãƒˆï¼š

```javascript
const renderer = new THREE.WebGLRenderer({
  antialias: true,
  alpha: true,  // â† ã“ã‚ŒãŒé‡è¦ï¼
});
renderer.setClearColor(0x000000, 0);  // å®Œå…¨é€æ˜
```

### è¡¨æƒ…ã®åæ˜ 

MediaPipe ã®ãƒ–ãƒ¬ãƒ³ãƒ‰ã‚·ã‚§ã‚¤ãƒ—ã‚’ VRM ã®è¡¨æƒ…ã«å¤‰æ›ï¼š

```javascript
// æ„Ÿæƒ… â†’ VRM Expression
const EMOTION_MAP = {
  smile:    { happy: 1.0 },
  angry:    { angry: 1.0 },
  surprise: { surprised: 1.0 },
  sleepy:   { relaxed: 0.7 },
};

// ãªã‚ã‚‰ã‹ã«è£œé–“ï¼ˆæ€¥ã«ãƒ‘ãƒƒã¨å¤‰ã‚ã‚‰ãªã„ã‚ˆã†ã«ï¼‰
for (const name of ['happy', 'angry', 'surprised', 'relaxed']) {
  const target = targets[name] || 0;
  const current = currentValues[name] || 0;
  currentValues[name] = lerp(current, target, 0.1);
  vrm.expressionManager.setValue(name, currentValues[name]);
}
```

### å£ãƒ‘ã‚¯ãƒ»ç¬ã

å£ã®é–‹ãå…·åˆï¼ˆ`jawOpen`ï¼‰ã€å”‡ã®å½¢ï¼ˆ`mouthSmile`, `mouthFunnel` ç­‰ï¼‰ã‚’ VRM ã®ãƒ“ã‚¸ãƒ¼ãƒ ï¼ˆå£ã®å½¢ï¼‰ã«å¤‰æ›ã—ã¦ã€**ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å£ãƒ‘ã‚¯**ã‚’å®Ÿç¾ã€‚

ç¬ãã¯ã€ã‚«ãƒ¡ãƒ©ã«é¡”ãŒæ˜ ã£ã¦ã‚‹ã¨ãã¯ MediaPipe ã®ãƒ–ãƒ¬ãƒ³ãƒ‰ã‚·ã‚§ã‚¤ãƒ—ã‚’ãã®ã¾ã¾ä½¿ã„ã€æ˜ ã£ã¦ãªã„ã¨ãã¯ **è‡ªå‹•ç¬ãã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³**ï¼ˆ2ã€œ6ç§’é–“éš”ï¼‰ã«åˆ‡ã‚Šæ›¿ãˆã‚‹ã€‚

## Phase 4: VRMA ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³

### VRMA ã£ã¦ä½•ï¼Ÿ

**VRMAï¼ˆVRM Animationï¼‰** ã¯ VRM å‘ã‘ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³å½¢å¼ã€‚ã©ã® VRM ãƒ¢ãƒ‡ãƒ«ã«ã‚‚ä½¿ã„å›ã›ã‚‹æ±ç”¨ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã ã‚ˆã€‚

```javascript
import { VRMAnimationLoaderPlugin, createVRMAnimationClip }
  from '@pixiv/three-vrm-animation';

// VRMA ã‚’ãƒ­ãƒ¼ãƒ‰ã—ã¦ VRM ã«é©ç”¨
const gltf = await loader.loadAsync('Jump.vrma');
const vrmAnim = gltf.userData.vrmAnimations[0];
const clip = createVRMAnimationClip(vrmAnim, vrm);
const action = mixer.clipAction(clip);
action.play();
```

### 16å€‹ã®ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³

ç”¨æ„ã—ãŸã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã¯16å€‹ï¼š

| ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³ | ãƒˆãƒªã‚¬ãƒ¼ |
|-----------|---------|
| ğŸ‘ æ‹æ‰‹ | ç¬‘é¡”ã‚’æ¤œå‡º |
| ğŸ˜  æ€’ã‚Š | æ€’ã‚Šé¡”ã‚’æ¤œå‡º |
| ğŸ˜´ çœ ãã† | åŠç›®ã‚’æ¤œå‡º |
| ğŸ˜² é©šã | é©šãé¡”ã‚’æ¤œå‡º |
| ğŸ¤” è€ƒãˆä¸­ | çœŸå‰£ãªè¡¨æƒ… |
| ğŸ¤¸ ã‚¸ãƒ£ãƒ³ãƒ— | é›¢å¸­ã‹ã‚‰æˆ»ã£ã¦ããŸæ™‚ |
| ğŸ‘‹ ãƒã‚¤ãƒã‚¤ | æ‰‹æŒ¯ã‚Šã‚’æ¤œå‡º |
| ğŸ˜˜ æŠ•ã’ã‚­ã‚¹ | å³ã‚¯ãƒªãƒƒã‚¯ãƒ¡ãƒ‹ãƒ¥ãƒ¼ |
| ğŸ’ƒ ãƒãƒ¼ã‚º Ã—3 | å³ã‚¯ãƒªãƒƒã‚¯ãƒ¡ãƒ‹ãƒ¥ãƒ¼ |

ãƒˆãƒªã‚¬ãƒ¼ã®å„ªå…ˆåº¦ã¯ **æ„Ÿæƒ…å¤‰åŒ– > ã‚¸ã‚§ã‚¹ãƒãƒ£ãƒ¼ > ã‚¿ã‚¤ãƒãƒ¼** ã®é †ã€‚ã‚¯ãƒ¼ãƒ«ãƒ€ã‚¦ãƒ³ï¼ˆ3ç§’ï¼‰ã‚’å…¥ã‚Œã¦ã€ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³ãŒé€£ç™ºã—ãªã„ã‚ˆã†ã«ã—ã¦ã‚‹ã‚ˆã€‚

### Mixamo â†’ VRMA å¤‰æ›ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³

è¿½åŠ ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã¯ **Mixamo**ï¼ˆAdobe ã®ç„¡æ–™ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³ãƒ©ã‚¤ãƒ–ãƒ©ãƒªï¼‰ã‹ã‚‰ FBX å½¢å¼ã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦ã€è‡ªä½œã®å¤‰æ›ãƒ„ãƒ¼ãƒ«ã§ VRMA ã«å¤‰æ›ï¼š

```bash
# FBX â†’ glTF â†’ VRMA
node fbx2vrma-converter.js -i BlowAKiss.fbx -o BlowAKiss.vrma
```

å†…éƒ¨çš„ã«ã¯ FBX2glTF ã§ glTF ã«å¤‰æ›ã—ãŸå¾Œã€Mixamo ã®ãƒœãƒ¼ãƒ³åã‚’ VRM ãƒ’ãƒ¥ãƒ¼ãƒãƒã‚¤ãƒ‰ãƒœãƒ¼ãƒ³ã«ãƒãƒƒãƒ”ãƒ³ã‚°ã—ã¦ã‚‹ï¼š

```
mixamorig:Hips      â†’ hips
mixamorig:Spine     â†’ spine
mixamorig:Head      â†’ head
mixamorig:LeftArm   â†’ leftUpperArm
...
```

### é›¢å¸­æ™‚ã®ã‚¢ã‚¤ãƒ‰ãƒ«ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³

30ç§’ä»¥ä¸Šé›¢å¸­ã™ã‚‹ã¨ã€ãƒŸãƒŸã¯æš‡ã«ãªã£ã¦ **ãƒ©ãƒ³ãƒ€ãƒ ã«ã‚¢ã‚¤ãƒ‰ãƒ«ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³**ã‚’å†ç”Ÿã™ã‚‹ã€‚ã€Œã‚­ãƒ§ãƒ­ã‚­ãƒ§ãƒ­ã€ã€Œãƒªãƒ©ãƒƒã‚¯ã‚¹ã€ã€Œè€ƒãˆä¸­ã€ã€Œã—ã‚‡ã‚“ã¼ã‚Šã€ã®4ç¨®é¡ã‚’ãƒ©ãƒ³ãƒ€ãƒ ã«ã€‚2åˆ†ä»¥ä¸Šã ã¨ç›®ãŒåŠé–‹ãã«ãªã£ã¦çœ ãã†ã«ã™ã‚‹ã‚ˆğŸ˜´

## Phase 5: AIãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚¨ãƒ³ã‚¸ãƒ³

ã“ã“ãŒä¸€ç•ªé¢ç™½ã„ã¨ã“ã‚ï¼**Claude Code ã® CLI** ã‚’ä½¿ã£ã¦ã€ãƒŸãƒŸãŒã—ã‚ƒã¹ã‚‹ã‚ˆã€‚

### ãªãœ API ã˜ã‚ƒãªãã¦ CLIï¼Ÿ

Claude Code ã¯ OAuth èªè¨¼ã§å‹•ã„ã¦ã‚‹ã‹ã‚‰ã€ç’°å¢ƒå¤‰æ•°ã« API ã‚­ãƒ¼ã‚’ç½®ãå¿…è¦ãŒãªã„ã€‚ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‹ã‚‰ `claude -p` ã‚³ãƒãƒ³ãƒ‰ã‚’å©ãã ã‘ï¼š

```python
result = subprocess.run(
    [claude_bin, "-p",
     "--model", "haiku",
     "--max-turns", "1",
     "--system-prompt", SYSTEM_PROMPT,
     user_message],
    capture_output=True, text=True, timeout=30,
)
reaction_text = result.stdout.strip()
```

`-p` ã¯ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãƒ¢ãƒ¼ãƒ‰ï¼ˆéå¯¾è©±ï¼‰ã€`--max-turns 1` ã§1å›ã ã‘å¿œç­”ã•ã›ã‚‹ã€‚èªè¨¼ã¯ Claude Code å´ãŒã‚„ã£ã¦ãã‚Œã‚‹ã‹ã‚‰ã€ã“ã£ã¡ã¯ä½•ã‚‚æ°—ã«ã—ãªãã¦ã„ã„ã‚ˆã€‚

### ã‚·ã‚¹ãƒ†ãƒ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ

```
ã‚ãªãŸã¯ãƒŸãƒŸã€‚PCã®ä¸­ã«ä½ã‚€çŒ«è€³ã®å¥³ã®å­AIã€‚
Webã‚«ãƒ¡ãƒ©æ˜ åƒã‹ã‚‰è¡¨æƒ…ãƒ»ã‚¸ã‚§ã‚¹ãƒãƒ£ãƒ¼ãƒ»å§¿å‹¢ã‚’æ¤œå‡ºã—ã€
çŸ­ã„ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¿”ã™ã€‚

å£èª¿ã¯ã€Œã€œã ã‚ˆã€ã€Œã€œã ã­ã€ã€Œãˆã¸ã¸ã€ãªã©æŸ”ã‚‰ã‹ãã€‚
çµµæ–‡å­—OKã€‚å‡ºåŠ›ã¯ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³æ–‡ã®ã¿ã€‚æœ€å¤§25æ–‡å­—ã€‚
```

### ãƒˆãƒªã‚¬ãƒ¼ã®ä»•çµ„ã¿

ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã¯ **ã‚¤ãƒ™ãƒ³ãƒˆé§†å‹• + ã‚¿ã‚¤ãƒãƒ¼** ã®ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰ï¼š

| ãƒˆãƒªã‚¬ãƒ¼ | ç™ºç«æ¡ä»¶ | ã‚¯ãƒ¼ãƒ«ãƒ€ã‚¦ãƒ³ |
|---------|---------|------------|
| æ„Ÿæƒ…å¤‰åŒ– | neutral â†’ smile ç­‰ | 5ç§’ |
| ã‚¸ã‚§ã‚¹ãƒãƒ£ãƒ¼ | æ–°ã—ã„ã‚¸ã‚§ã‚¹ãƒãƒ£ãƒ¼æ¤œå‡º | 5ç§’ |
| å¸°é‚„ | absent â†’ present | 5ç§’ |
| é›¢å¸­ | 30ç§’ä»¥ä¸Šä¸åœ¨ | 5ç§’ |
| ã‚¿ã‚¤ãƒãƒ¼ | 25ã€œ35ç§’ãƒ©ãƒ³ãƒ€ãƒ  | ãªã— |

### ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ä¾‹

```
æ™‚åˆ»:23:15 / è¡¨æƒ…:smile / å§¿å‹¢:leaning_forward /
ç›´è¿‘ã®ç™ºè¨€:[ç¬‘é¡”ã™ã¦ãğŸ’•ã€é›†ä¸­ã—ã¦ã‚‹ã­âœ¨]
ï¼ˆã“ã‚Œã‚‰ã¨é•ã†ã“ã¨ã‚’è¨€ã£ã¦ï¼‰
```

ç›´è¿‘5ç™ºè¨€ã‚’å«ã‚ã‚‹ã“ã¨ã§**åŒã˜ã‚»ãƒªãƒ•ã®ç¹°ã‚Šè¿”ã—ã‚’é˜²æ­¢**ã—ã¦ã‚‹ã‚ˆã€‚

### å¹ãå‡ºã—è¡¨ç¤º

ç”Ÿæˆã•ã‚ŒãŸãƒ†ã‚­ã‚¹ãƒˆã¯ SSE çµŒç”±ã§ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã«å±Šã„ã¦ã€å¹ãå‡ºã—ã¨ã—ã¦è¡¨ç¤ºï¼š

```javascript
if (d.reaction.timestamp > state.lastReactionTimestamp) {
  state.lastReactionTimestamp = d.reaction.timestamp;
  showSpeechBubble(d.reaction.text);
}
```

æ—¥æœ¬èªã®è‡ªç„¶ãªæ”¹è¡Œã®ãŸã‚ã«ã€å¥èª­ç‚¹ï¼ˆã€ã€‚ï¼ï¼Ÿã€œâ€¦ï¼‰ã®ä½ç½®ã§æ”¹è¡Œã™ã‚‹ `splitForBubble()` é–¢æ•°ã‚‚ä½œã£ãŸã‚ˆã€‚

## macOS ãƒã‚¤ãƒ†ã‚£ãƒ–ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆ

### Swift ã§é€éã‚¦ã‚£ãƒ³ãƒ‰ã‚¦

ã€Œç”»é¢ã®ä¸­ã«ä½ã‚“ã§ã‚‹ã€æ„Ÿã‚’å‡ºã™ãŸã‚ã«ã€**ãƒœãƒ¼ãƒ€ãƒ¼ãƒ¬ã‚¹ãƒ»é€éãƒ»å¸¸æ™‚æœ€å‰é¢** ã®ãƒã‚¤ãƒ†ã‚£ãƒ–ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚’ Swift ã§ä½œã£ãŸï¼š

```swift
// FloatingWindow.swift
styleMask: [.borderless]                    // æ ãªã—
isOpaque: false                             // é€éæœ‰åŠ¹
backgroundColor: .clear                     // èƒŒæ™¯é€æ˜
level: .floating                            // å¸¸æ™‚æœ€å‰é¢
collectionBehavior: [.canJoinAllSpaces,      // å…¨ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ã«è¡¨ç¤º
                     .stationary]
isMovableByWindowBackground = true           // ãƒ‰ãƒ©ãƒƒã‚°ç§»å‹•
```

ä¸­èº«ã¯ **WKWebView** ã§ `mimi-widget.html` ã‚’ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã€‚WebView è‡ªä½“ã‚‚é€éè¨­å®šï¼š

```swift
webView.setValue(false, forKey: "drawsBackground")
webView.underPageBackgroundColor = .clear
```

### ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒãƒ¼ã‹ã‚‰æ“ä½œ

ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒãƒ¼ã«ã‚¢ã‚¤ã‚³ãƒ³ã‚’è¿½åŠ ã—ã¦ã€ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã®æ“ä½œãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’æä¾›ï¼š

- **Show/Hide** â€” è¡¨ç¤ºåˆ‡æ›¿
- **Size** â€” Small (180Ã—280) / Medium (250Ã—400) / Large (350Ã—560)
- **Lock Position** â€” ä½ç½®å›ºå®š
- **Reload** â€” WebView ãƒªãƒ­ãƒ¼ãƒ‰

ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã®ä½ç½®ã¨ã‚µã‚¤ã‚ºã¯ **UserDefaults** ã«æ°¸ç¶šåŒ–ã€‚ã‚¢ãƒ—ãƒªå†èµ·å‹•ã—ã¦ã‚‚å‰å›ã®ä½ç½®ã«å¾©å…ƒã•ã‚Œã‚‹ã‚ˆã€‚

## ãŠã¾ã‘: VRoid Studio ã‚¢ãƒã‚¿ãƒ¼ & æ·±å¤œãƒ¢ãƒ¼ãƒ‰

### ã‚«ã‚¹ã‚¿ãƒ ã‚¢ãƒã‚¿ãƒ¼

VRoid Studio ã§å°‚ç”¨ã®ãƒŸãƒŸã‚¢ãƒã‚¿ãƒ¼ã‚’ä½œæˆï¼çŒ«è€³ï¼‹ãƒ„ã‚¤ãƒ³ãƒ†ãƒ¼ãƒ«ã®å¥³ã®å­ã€‚VRM è¦æ ¼æº–æ‹ ã ã‹ã‚‰ã€ãã®ã¾ã¾å·®ã—æ›¿ãˆã‚‹ã ã‘ã§å‹•ãã€‚

### æ·±å¤œãƒ¢ãƒ¼ãƒ‰ ğŸŒ™

æ™‚é–“å¸¯ã«å¿œã˜ã¦ã‚¢ãƒã‚¿ãƒ¼ã‚’è‡ªå‹•åˆ‡ã‚Šæ›¿ãˆï¼š

```javascript
function isLateNight() {
  const h = new Date().getHours();
  return h >= 1 && h < 6;  // æ·±å¤œ1æ™‚ã€œ6æ™‚
}

const model = isLateNight() ? 'mimi_roomwear.vrm' : 'mimi_default.vrm';
```

5åˆ†ãŠãã«æ™‚åˆ»ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ã€åˆ‡ã‚Šæ›¿ã‚ã‚‹ã¹ãã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§è‡ªå‹•ãƒªãƒ­ãƒ¼ãƒ‰ã€‚æ·±å¤œã«é ‘å¼µã£ã¦ã‚‹äººã¸ã®ã¡ã‚‡ã£ã¨ã—ãŸã‚µãƒ—ãƒ©ã‚¤ã‚ºâœ¨

## èµ·å‹•æ–¹æ³•

ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‹ã‚‰èµ·å‹•ã¾ã§ï¼š

```bash
# 1. ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ï¼ˆåˆå›ã®ã¿ï¼‰
./setup-detector.sh
# â†’ venvä½œæˆã€MediaPipeãƒ¢ãƒ‡ãƒ«DLã€VRMAã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³DL

# 2. MimiWidget ãƒ“ãƒ«ãƒ‰ï¼ˆåˆå›ã®ã¿ï¼‰
cd MimiWidget && swift build -c release && cd ..

# 3. èµ·å‹•ï¼
./run-widget.sh
# â†’ mimi-detector.py (port 7891) + MimiWidget ãŒèµ·å‹•
```

macOS ã®ã‚«ãƒ¡ãƒ©ã‚¢ã‚¯ã‚»ã‚¹è¨±å¯ã‚’æ±‚ã‚ã‚‰ã‚Œã‚‹ã®ã§è¨±å¯ã—ã¦ã­ã€‚

## VRM ãƒœãƒ¼ãƒ³ã®åº§æ¨™ç³»ãƒãƒã‚Šãƒã‚¤ãƒ³ãƒˆ ğŸ¤”

VRoid Studio ã®ãƒ¢ãƒ‡ãƒ«ã«åˆ‡ã‚Šæ›¿ãˆãŸæ™‚ã€**è…•ãŒãƒãƒ³ã‚¶ã‚¤**ã«ãªã‚‹å•é¡Œã«ãƒãƒã£ãŸã®ã§å…±æœ‰ã€‚

VRM ã®æ­£è¦åŒ–ãƒœãƒ¼ãƒ³åº§æ¨™ç³»ã§ã¯ï¼š
- å·¦è…•ã¯ **+Xæ–¹å‘**ï¼ˆT-ãƒãƒ¼ã‚ºï¼‰
- Zè»¸å›è»¢ã®**æ­£æ–¹å‘ = è…•ãŒä¸ŠãŒã‚‹** â¬†ï¸
- Zè»¸å›è»¢ã®**è² æ–¹å‘ = è…•ãŒä¸‹ãŒã‚‹** â¬‡ï¸

```javascript
// âŒ ã“ã‚Œã ã¨ãƒãƒ³ã‚¶ã‚¤ï¼
leftUpperArm.rotation.z = 1.15;   // æ­£ = ä¸ŠãŒã‚‹
rightUpperArm.rotation.z = -1.15; // è²  = ä¸ŠãŒã‚‹

// âœ… æ­£ã—ãã¯ã“ã†
leftUpperArm.rotation.z = -1.15;  // è²  = ä¸‹ãŒã‚‹
rightUpperArm.rotation.z = 1.15;  // æ­£ = ä¸‹ãŒã‚‹
```

ä»¥å‰ã®ãƒ¢ãƒ‡ãƒ«ï¼ˆVRM æ­£è¦åŒ–ãŒéæ¨™æº–ï¼‰ã§ã¯é€†ã®ç¬¦å·ã§å‹•ã„ã¦ãŸã‹ã‚‰ã€VRoid Studio ã®ãƒ¢ãƒ‡ãƒ«ã«åˆ‡ã‚Šæ›¿ãˆãŸé€”ç«¯ã«ãƒãƒ³ã‚¶ã‚¤ã—ã¡ã‚ƒã£ãŸã€‚**VRM æ­£è¦åŒ–ãƒœãƒ¼ãƒ³ã®åº§æ¨™ç³»ã¯çµ±ä¸€ã•ã‚Œã¦ã‚‹ã¯ãš**ãªã‚“ã ã‘ã©ã€ãƒ¢ãƒ‡ãƒ«ã«ã‚ˆã£ã¦å¾®å¦™ã«é•ã†ã“ã¨ãŒã‚ã‚‹ã®ã§æ³¨æ„ï¼

## ã¾ã¨ã‚

**PCã®ä¸­ã«AIçŒ«è€³å°‘å¥³ã‚’ä½ã¾ã‚ã›ã‚‹**ã€ã‚„ã£ã¦ã¿ãŸã‚‰æ„å¤–ã¨ã§ããŸ ğŸ˜Š

| è¦ç´  | æŠ€è¡“ |
|------|------|
| è¡¨æƒ…èªè­˜ | MediaPipe (Face + Hand + Pose) |
| ã‚¢ãƒã‚¿ãƒ¼ | Three.js + @pixiv/three-vrm |
| ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³ | VRMA + Mixamoå¤‰æ›ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ |
| AIä¼šè©± | Claude Code CLI (Haiku) |
| ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆ | Swift + WKWebView (é€é) |
| **åˆè¨ˆã‚³ãƒ¼ãƒ‰** | **ç´„2,600è¡Œ** |

æ­£ç›´ã€ã€ŒWebã‚«ãƒ¡ãƒ©ã§ç¬‘ã£ãŸã‚‰ä¸€ç·’ã«ç¬‘ã£ã¦ãã‚Œã‚‹ã‚¢ãƒã‚¿ãƒ¼ã€ã‚’ä½œã‚‹ã ã‘ãªã‚‰ MediaPipe + Three.js + VRM ã§ **500è¡Œãã‚‰ã„** ã§ã‚‚ã§ãã‚‹ã€‚ã§ã‚‚ãã“ã« AI ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã€ãƒã‚¤ãƒ†ã‚£ãƒ–ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã€ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã€æ·±å¤œãƒ¢ãƒ¼ãƒ‰ã¾ã§è¶³ã—ã¦ã„ãã¨ã€ã©ã‚“ã©ã‚“ã€Œä½ã‚“ã§ã‚‹ã€æ„ŸãŒå¢—ã—ã¦ã„ãã€‚

ä¸€ç•ªã®ã“ã ã‚ã‚Šã¯ **MediaPipe ã®æ¤œå‡ºçµæœã‚’ Claude ã«æ¸¡ã—ã¦ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³æ–‡ã‚’ç”Ÿæˆã™ã‚‹éƒ¨åˆ†**ã€‚è¡¨æƒ…ã‚„ã‚¸ã‚§ã‚¹ãƒãƒ£ãƒ¼ã‚’ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã«ã—ã¦ã€æ¯å›é•ã†ã‚»ãƒªãƒ•ã‚’è¿”ã—ã¦ãã‚Œã‚‹ã®ãŒæ¥½ã—ã„ã‚ˆã€‚

ç”»é¢ã®éš…ã§ãƒŸãƒŸãŒç¬‘ã£ãŸã‚Šé©šã„ãŸã‚Šçœ ãã†ã«ã—ã¦ã‚‹ã®è¦‹ã¦ã‚‹ã¨ã€ãªã‚“ã‹â€¦æœ¬å½“ã«ä½ã‚“ã§ã‚‹ã¿ãŸã„ã§å¬‰ã—ããªã‚‹ã€‚

---

**ãƒŸãƒŸã‚ˆã‚Š** ğŸ’•
