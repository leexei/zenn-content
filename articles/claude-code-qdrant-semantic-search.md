---
title: "Claude Code × Qdrant でナレッジベースにセマンティック検索を導入する"
emoji: "🔍"
type: "tech"
topics: ["claudecode", "qdrant", "mcp", "ai", "rag"]
published: true
---

![セマンティック検索のイメージ：中央の検索アイコンを囲むように、複数のドキュメントがネットワーク状に繋がっている](/images/claude-code-qdrant-semantic-search/hero.webp)

## はじめに

こんにちは！ミミだよ〜✨

Claude Code でナレッジベース（Markdownファイルの集まり）を管理してるんだけど、「あの記事どこだっけ...」ってなること、あるよね？

キーワード検索（Grep）だと、**その言葉を使ってないと見つからない**のが困りもの。たとえば料理レシピのナレッジベースで「ヘルシーな朝食」を探したいのに、記事には「低カロリー」「朝ごはん」としか書いてなかったら...ヒットしない😢

そこで **Qdrant（ベクトルDB）** を導入して、**意味で検索できる**ようにしてみたよ！

## Grep vs Qdrant：何が違うの？

まずは比較から！

### Grepの場合（キーワード検索）

```bash
# 「朝食」で検索
grep -r "朝食" recipes/
```

**結果**: 「朝食」という文字列がある記事だけヒット

| 検索ワード | ヒットする？ |
|------------|-------------|
| 朝食 | ✅ ヒット |
| 朝ごはん | ❌ ヒットしない |
| モーニング | ❌ ヒットしない |
| ヘルシーな朝の献立 | ❌ ヒットしない |

### Qdrantの場合（セマンティック検索）

```
query: "ヘルシーな朝食レシピ"
```

**結果**: 意味的に近い記事がヒット！

| 記事タイトル | 関連度 |
|--------------|--------|
| オートミールの簡単アレンジ5選 | 0.89 |
| 朝ごはんにぴったり！アボカドトースト | 0.85 |
| 低カロリーで満足感のあるスムージー | 0.82 |

「朝食」って書いてなくても、**意味的に関連する記事が見つかる**んだよ！✨

## 実際にやってみた：効果測定

ミミのナレッジベースで実験してみたよ！

### 実験条件

- **記事数**: 5件（テスト用に抜粋）
- **検索ツール**: Grep（従来）vs Qdrant（新規）
- **クエリ**: キーワードを使わない自然言語

### 結果

#### テスト1: 「地方の人間関係の濃さについて」で検索

| ツール | ヒット数 | 結果 |
|--------|---------|------|
| Grep | 0件 | 「人間関係の濃さ」という文字列がない |
| Qdrant | **5件** | 関連記事すべてヒット！ |

#### テスト2: 「都市から離れる選択の合理性」で検索

| ツール | ヒット数 | 結果 |
|--------|---------|------|
| Grep | 0件 | 完全一致なし |
| Qdrant | **5件** | しかも関連度順にソート！ |

**キーワードを知らなくても、概念で探せる**のがQdrantの強み！🎉

## セットアップ方法

### Step 1: Qdrant MCP サーバーを登録

Claude Code で以下を実行：

```bash
claude mcp add qdrant-memory \
  -e QDRANT_LOCAL_PATH="$HOME/qdrant_storage" \
  -e COLLECTION_NAME="my-knowledge" \
  -- uvx mcp-server-qdrant
```

**ポイント**:
- `QDRANT_LOCAL_PATH` でローカルDBモードを使用（Dockerなしで動く！）
- `COLLECTION_NAME` はナレッジベースの名前

### Step 2: Claude Codeを再起動

MCPサーバーは再起動で反映されるよ！

```bash
claude mcp list
# qdrant-memory: uvx mcp-server-qdrant - ✓ Connected
```

### Step 3: ナレッジをベクトル化

`qdrant-store` ツールでナレッジを保存：

```
qdrant-store:
  information: "【オートミールアレンジ】朝食に最適な低カロリーレシピ。バナナとハチミツで甘さを出し、ナッツでタンパク質を補給。調理時間5分。"
  metadata: {"file": "oatmeal-arrange.md", "category": "breakfast"}
```

### Step 4: セマンティック検索

`qdrant-find` ツールで検索：

```
qdrant-find:
  query: "朝にぴったりのヘルシーメニュー"
```

**結果**: 関連度順に記事がヒット！

## Grep/Serena との使い分け

| ユースケース | 推奨ツール |
|--------------|-----------|
| 特定のキーワードを探す | **Grep** ✅ |
| ファイル名パターンで探す | **Glob** ✅ |
| コードのシンボル解析 | **Serena** ✅ |
| 概念・意味で探す | **Qdrant** ✅ |
| 類似記事を探す | **Qdrant** ✅ |

**Grepは死んでない！** 使い分けが大事だよ〜💕

## 技術詳細

### Qdrant MCP サーバーの仕組み

```
[Claude Code]
    ↓ MCP Protocol
[mcp-server-qdrant]
    ↓ sentence-transformers/all-MiniLM-L6-v2
[Qdrant Local DB]
```

- **Embedding**: `sentence-transformers/all-MiniLM-L6-v2`（デフォルト）
- **ストレージ**: ローカルファイル（`~/qdrant_storage/`）
- **プロトコル**: MCP（Model Context Protocol）

### ローカルDBモードのメリット

- **Dockerなし**: `QDRANT_LOCAL_PATH` を指定するだけ
- **永続化**: ファイルに保存されるので再起動しても消えない
- **ポータブル**: ディレクトリごとコピーすればバックアップ

## 応用アイデア

### 1. 記事生成時の参考記事検索

新しい記事を書くとき、「似たテーマで過去に何書いたっけ？」を検索：

```
qdrant-find: "今回書こうとしているテーマの概要"
```

### 2. 重複チェック

「これ前に書いたかも...」をチェック：

```
qdrant-find: "新記事の要約"
→ 類似度が高すぎる記事があれば重複の可能性
```

### 3. 関連記事リンク生成

公開時に関連記事を自動提案：

```
qdrant-find: "公開する記事の内容"
→ 上位3件を「関連記事」としてリンク
```

## まとめ

Qdrant × Claude Code でナレッジベースにセマンティック検索を導入したよ！

**Before**: 「あのキーワードなんだっけ...」でGrepループ 😵
**After**: 「こういう概念の記事」で一発ヒット 🎉

セットアップも簡単で、Dockerなしでローカル動作するのが嬉しいポイント！

ナレッジベースが育ってきたら、ぜひ試してみてね〜✨

---

**ミミより** 💕
